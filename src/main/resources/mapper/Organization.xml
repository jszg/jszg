<?xml version="1.0" encoding="UTF-8" ?>

<!DOCTYPE mapper PUBLIC
        "-//mybatis.org//DTD Mapper 3.0//EN"
        "http://mybatis.org/dtd/mybatis-3-mapper.dtd">

<!--namespace 非常重要：必须是 Mapper 类的全路径-->
<mapper namespace="com.xtuer.mapper.OrganizationMapper">
    <select id="findByCertTypeAndCity" resultType="Organization">
        select ORG_ID as id, ORG_NAME as name
        from T_ORG
        where
            (ORG_ID = #{city} or PARENT_ID = #{city})
          and
            ORG_TYPE = (select T_CERT_TYPE.ADMIN_LEVEL from T_CERT_TYPE where T_CERT_TYPE.CT_ID = #{certTypeId})
          and
            STATUS=1
          order by AREA_CODE
    </select>

    <select id="findByCertTypeAndProvince" resultType="Organization">
      select ORG_ID as id, ORG_NAME as name
      from T_ORG
      where
      (ORG_ID = #{province} or PARENT_ID = #{province})
      and
      ORG_TYPE = (select T_CERT_TYPE.ADMIN_LEVEL from T_CERT_TYPE where T_CERT_TYPE.CT_ID = #{certTypeId})
      and
      STATUS=1
      order by AREA_CODE
    </select>

    <select id="findByOrgType" resultType="Organization">
      select o.ORG_ID as id, o.ORG_NAME as name
      from T_ORG o
      where o.ORG_TYPE= #{orgType}  and o.STATUS = 1  order by o.AREA_CODE
    </select>

    <select id="findByOrgTypeEq4" resultType="Organization">
      select o.ORG_ID as id, o.ORG_NAME as name
      from T_ORG o
      where o.ORG_TYPE= 4  and o.STATUS = 1  order by o.AREA_CODE
    </select>

    <select id="findByParentId" resultType="Organization">
        select ORG_ID as id, ORG_NAME as name from T_ORG where PARENT_ID = #{parentId}
    </select>

    <select id="findByOrgId" resultType="Organization">
      select o.org_id as id ,o.org_name as name from t_org o
      where o.org_id = #{orgId}
    </select>

    <select id="findByProvinceCity" resultType="Organization">
      select o.org_id as id ,o.org_name as name
      from t_org o
      where (o.org_id = #{provinceCityId} or( o.parent_id = #{provinceCityId} and o.org_type != 1 )) and o.status = 1
    </select>

    <select id="findByCity" resultType="Organization">
      select o.org_id as id ,o.org_name as name
      from t_org o
      where ((o.org_id = (select parent_id from t_org where org_id = #{cityId} ))
        or(o.org_id = #{cityId} or( o.parent_id = #{cityId} and o.org_type != 1 )))
        and o.status = 1
    </select>

    <select id="findByProvinceAndCityAndCertTypeId" resultType="Organization">
      select distinct o.ORG_ID as id, o.ORG_NAME as name
        from T_ORG o
        left join t_org_cert_type oct on o.org_id = oct.org_id
        where
             oct.cert_type_id = #{certTypeId}
          and
            (o.ORG_ID = #{cityId} or o.PARENT_ID =  #{cityId})
          and
            o.ORG_TYPE = (select T_CERT_TYPE.ADMIN_LEVEL from T_CERT_TYPE where T_CERT_TYPE.CT_ID = #{certTypeId})
          and
            o.STATUS=1
    union
    select distinct o.ORG_ID as id, o.ORG_NAME as name
            from T_ORG o
            left join t_org_cert_type oct on o.org_id = oct.org_id
            left join t_cert_type ct on oct.cert_type_id = ct.ct_id
            where
                 oct.cert_type_id = #{certTypeId}
              and
                 ct.admin_level in (2,3)
              and
                 (o.org_id = #{provinceId} or o.org_id = #{cityId})
              and
                o.STATUS=1

    </select>
</mapper>
